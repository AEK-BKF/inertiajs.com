import dedent from 'dedent'
import Layout from '../components/Layout'
import Notice from '../components/Notice'
import TabbedCodeExamples from '../components/TabbedCodeExamples'

export default Layout
export const meta = { title: 'Code splitting' }

# Code splitting

To use code splitting with Inertia you'll need to enable [dynamic imports](https://github.com/tc39/proposal-dynamic-import). You'll need a Babel plugin to make this work. First, install the plugin:

```bash
npm install @babel/plugin-syntax-dynamic-import --save
```

Next, create a `.babelrc` file in your project with the following:

```json
{
  "plugins": ["@babel/plugin-syntax-dynamic-import"]
}
```

Alternatively, if you're using Laravel Mix, you can put this in your `webpack.mix.js` file:

```js
mix.babelConfig({
  plugins: ['@babel/plugin-syntax-dynamic-import'],
})
```

<Notice>
  When using Laravel Mix (v4) with dynamic imports you cannot use styles within Vue files due to current Webpack{' '}
  <a href="https://github.com/JeffreyWay/laravel-mix/issues/1856#issuecomment-448082909">limitations</a>. As a
  workaround, you need to drop Mix entirely or downgrade to v3.
</Notice>

## Using Inertia without code splitting

It's possible to also use Inertia without code splitting. This will generate one larger JavaScript bundle, instead of many smaller ones. With this approach, the dynamic imports Babel plugin is not required.

One way to do this is manually loading all your page components:

<TabbedCodeExamples
  examples={[
    {
      name: 'Vue.js',
      language: 'js',
      code: dedent`
        import Inertia from 'inertia-vue'
        import Vue from 'vue'\n
        Vue.use(Inertia)\n
        const app = document.getElementById('app')\n
        const pages = {
          'Dashboard/Index': require('./Pages/Dashboard/Index').default,
          'Users/Index': require('./Pages/Users/Index').default,
          'Users/Create': require('./Pages/Users/Create').default,
          // etc...
        }\n
        new Vue({
          render: h => h(Inertia, {
            props: {
              initialPage: JSON.parse(app.dataset.page),
              resolveComponent: name => pages[name],
            },
          }),
        }).$mount(app)
      `,
    },
    {
      name: 'React',
      language: 'jsx',
      code: dedent`
        import Inertia from 'inertia-react'
        import React from 'react'
        import { render } from 'react-dom'\n
        const app = document.getElementById('app')\n
        const pages = {
          'Dashboard/Index': require('./Pages/Dashboard/Index').default,
          'Users/Index': require('./Pages/Users/Index').default,
          'Users/Create': require('./Pages/Users/Create').default,
          // etc...
        }\n
        render(
          <Inertia
            initialPage={JSON.parse(app.dataset.page)}
            resolveComponent={name => pages[name]}
          />,
          app
        )
      `,
    },
  ]}
/>

Another option is to use `required.context` to automatically register all your page components.

<TabbedCodeExamples
  examples={[
    {
      name: 'Vue.js',
      language: 'js',
      code:
        dedent`
        import Inertia from 'inertia-vue'
        import Vue from 'vue'\n
        Vue.use(Inertia)\n
        const app = document.getElementById('app')\n
        const files = require.context('./', true, /\.vue$/i)\n
        new Vue({
          render: h => h(Inertia, {
            props: {
              initialPage: JSON.parse(app.dataset.page),
              resolveComponent: page => files(` +
        `\`./Pages/\${page}.vue\`` +
        dedent`).default,
            },
          }),
        }).$mount(app)
      `,
    },
    {
      name: 'React',
      language: 'jsx',
      code:
        dedent`
        import Inertia from 'inertia-react'
        import React from 'react'
        import { render } from 'react-dom'\n
        const app = document.getElementById('app')\n
        const files = require.context('./', true, /\.js$/i)\n
        render(
          <Inertia
            initialPage={JSON.parse(app.dataset.page)}
            resolveComponent={page => files(` +
        `\`./Pages/\${page}.js\`` +
        dedent`).default}
          />,
          app
        )
      `,
    },
  ]}
/>
